*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {  }
html, body {
  width: 100%; height: 100%;
  touch-action: none;
  -webkit-user-select: none;
  user-select: none;
}

/* ── Screens ─────────────────────────────────── */
.screen { position: fixed; inset: 0; display: flex; flex-direction: column; }
.screen.hidden { display: none; }

/* ── Character Select ────────────────────────── */
#select-screen {
  align-items: center;
  justify-content: flex-start;
  overflow: hidden;
}
#select-screen h1 {
  color: #f1f5f9;
  font-size: clamp(18px, 4vw, 26px);
  letter-spacing: 2px;
  text-transform: uppercase;
  padding: 16px 0 10px;
  flex-shrink: 0;
  text-shadow: 0 0 20px rgba(96,165,250,.6);
}
#select-screen p.hint {
  color: #64748b; font-size: 12px; margin-bottom: 12px; flex-shrink: 0;
}
#char-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(72px, 1fr));
  gap: 8px;
  padding: 8px 16px 16px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  width: 100%;
  flex: 1;
}
.char-card {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 6px;
  padding: 10px 6px 8px;
  border-radius: 10px;
  border: 2px solid #2a2a2a;
  cursor: pointer;
  transition: border-color .15s, background .15s, transform .1s;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
.char-card:hover   { background: #222; border-color: #3b82f6; }
.char-card.selected { background: #1e3a5f; border-color: #3b82f6;
                      box-shadow: 0 0 12px rgba(59,130,246,.4); }
.char-card:active  { transform: scale(.95); }
.char-preview {
  width: 64px; height: 64px;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
  background-image: url('sheet.png');
  background-repeat: no-repeat;
  /* backgroundPosition set by JS */
}
.char-card span {
  font-size: 10px; color: #94a3b8;
  text-align: center; line-height: 1.2;
}
.char-card.selected span { color: #93c5fd; }

#play-btn {
  flex-shrink: 0;
  margin: 12px auto 20px;
  padding: 13px 48px;
  background: #3b82f6; color: #fff;
  font-size: 16px; font-weight: 700;
  border: none; border-radius: 10px;
  cursor: pointer; touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
  letter-spacing: 1px;
  box-shadow: 0 4px 20px rgba(59,130,246,.4);
  transition: background .15s, transform .1s;
}
#play-btn:hover  { background: #2563eb; }
#play-btn:active { transform: scale(.97); }

/* ── Game screen ─────────────────────────────── */
#game-screen {
  flex-direction: column;
}
#app {
  display: flex;
  flex-direction: column;
  width: 100%;
  height: 100%;
}
#stage {
  flex: 1;
  position: relative;
  overflow: hidden;
  background: #0f0f0f;
  outline: none;
  touch-action: none;
}
#controls {
  flex-shrink: 0;
  height: 140px;
  background: #1a1a1a;
  border-top: 1px solid #333;
  display: flex;
  align-items: center;
  padding: 0 24px;
}
.player-wrap {
  position: absolute;
  width: 32px; height: 32px;
  will-change: transform;
}
.player {
  width: 32px; height: 32px;
  background-image: url('sheet.png');
  background-repeat: no-repeat;
  background-size: 384px 672px;
  image-rendering: pixelated;
  image-rendering: crisp-edges;
}
.player.facing-left {
  transform: scaleX(-1);
  transform-origin: 16px 16px;
}
#hud {
  position: absolute; left: 8px; top: 8px; z-index: 10;
  color: #cbd5e1; font-size: 11px;
  background: rgba(0,0,0,.55); padding: 5px 9px;
  border-radius: 6px; border: 1px solid #2a2a2a;
  pointer-events: none;
}
#timer {
  position: absolute; right: 8px; top: 8px; z-index: 10;
  color: #cbd5e1; font-size: 14px; font-weight: 700;
  background: rgba(0,0,0,.55); padding: 5px 10px;
  border-radius: 6px; border: 1px solid #2a2a2a;
  font-variant-numeric: tabular-nums;
  pointer-events: none;
}
#timer.urgent {
  color: #f87171; border-color: #7f1d1d;
  animation: pulse .45s ease-in-out infinite alternate;
}
@keyframes pulse { to { opacity: .35; } }

/* Change character button in game */
#change-char-btn {
  position: absolute; left: 8px; bottom: 8px; z-index: 10;
  background: rgba(0,0,0,.55); border: 1px solid #2a2a2a;
  color: #94a3b8; font-size: 11px; padding: 5px 9px;
  border-radius: 6px; cursor: pointer;
  touch-action: manipulation; -webkit-tap-highlight-color: transparent;
}
#change-char-btn:active { background: rgba(59,130,246,.3); }

.game-over {
  position: absolute; inset: 0; z-index: 30;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 14px;
  background: rgba(0,0,0,.78); color: #f1f5f9;
}
.game-over h2 { font-size: clamp(20px, 5vw, 30px); }
.game-over p  { font-size: clamp(13px, 3vw, 15px); color: #94a3b8; }
.game-over .btn-row { display: flex; gap: 12px; }
.game-over button {
  padding: 11px 24px; border: none; border-radius: 8px;
  color: #fff; font-size: clamp(13px, 3vw, 15px); font-weight: 700;
  cursor: pointer; touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}
.game-over button:active { opacity: .8; }
.btn-play-again { background: #3b82f6; }
.btn-change-char { background: #475569; }

.collectible {
  position: absolute; left: 0; top: 0;
  will-change: transform; pointer-events: none;
}
.collectible > span {
  display: block; font-size: 22px; line-height: 1;
  animation: bob 1.6s ease-in-out infinite;
}
@keyframes bob { 50% { transform: translateY(-4px); } }
.pop {
  position: absolute; left: 0; top: 0; z-index: 10;
  color: #fbbf24; font-weight: 700; font-size: 13px;
  text-shadow: 0 1px 3px rgba(0,0,0,.7);
  animation: upfade .6s ease-out forwards;
  pointer-events: none;
}
@keyframes upfade {
  0%   { opacity: 1; transform: translate(0,0); }
  100% { opacity: 0; transform: translate(0,-26px); }
}
#joystick-base {
  width: 150px; height: 150px; border-radius: 50%;
  background: rgba(255,255,255,.07);
  border: 2px solid rgba(255,255,255,.18);
  position: relative; flex-shrink: 0;
  touch-action: none;
}
#joystick-thumb {
  width: 46px; height: 46px; border-radius: 50%;
  background: rgba(255,255,255,.3);
  border: 2px solid rgba(255,255,255,.55);
  box-shadow: 0 2px 8px rgba(0,0,0,.4);
  position: absolute; top: 50%; left: 50%;
  transform: translate(-50%,-50%);
  pointer-events: none;
}
#mobile-score-display {
  margin-left: auto;
  color: #fbbf24; font-size: 32px; font-weight: 800;
  text-shadow: 0 2px 10px rgba(0,0,0,.5);
  padding-right: 8px;
}
